<!DOCTYPE html>
<html lang="en">
<head>
  <title>QM Quiz Results</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" 
          href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" /> 
</head>
<body class="bg-light">
    {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
        <div class="container mt-3">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endfor %}
            {% if redirect_url %}
            <script>
                setTimeout(function() {
                    fetch("{{ url_for('clear_flash_messages') }}", { method: "POST" });
                }, 1000); 
            </script>
        {% endif %}
        </div>
    {% endif %}
{% endwith %}
<div class="container mt-5">
    <div class="row justify content-center">
        <div class="col-md-6">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white text-center">
                    <h3>Quiz Results</h3>
                </div>
                <div class="card-body text-center">
                    <h4 class="mb-4">{{quiz.title}}</h4>
                    <p class="mb-2">
                        You scored <strong>{{score}}</strong>
                        out of <strong>{{quiz.questions|length}}</strong>
                    </p>
                    <details>
                        <summary class="btn btn-info">View Feedback</summary>
                        <div class="mt-3 text-left">
                            {% for q in quiz.questions %}
                                <div class="border p-3 mb-2">
                                    <p><strong>Q{{ loop.index }}: {{ q.q_statement }}</strong></p>
                    
                                    <p>Your Answer: 
                                        <strong>
                                            {% if user_answers[loop.index - 1]%}
                                                Option {{ user_answers[loop.index - 1] }}
                                            {% else %}
                                                Not Attempted
                                            {% endif %}
                                        </strong>
                                    </p>
                    
                                    <p>Correct Answer: <strong>Option {{ q.c_opt }}</strong></p>
                                    <div><strong>Feedback:</strong>
                                    {% if user_answers[loop.index - 1] != q.c_opt %}
                                        <p class="text-danger">Incorrect</p>
                                    {% else %}
                                        <p class="text-success">Correct</p>
                                    {% endif %}</div>
                                </div>
                            {% endfor %}
                        </div>
                    </details>
                    <br><br>
                    <a href="{{url_for('user_Dashboard')}}" class="btn btn-secondary">Back to Dashboard</a>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>